import { Component, Input, Output, EventEmitter } from '@angular/core';
import * as i0 from "@angular/core";
/**
 * A simple Angular2+ component used as a wrapper for [TreantJS](https://fperucic.github.io/treant-js/) library
 * for visualization of tree (chart) diagrams, with additional functionality.
 */
export class NgxTreantJsComponent {
    constructor() {
        this.clicked = new EventEmitter();
        this.hovered = new EventEmitter();
        this.dragged = new EventEmitter();
        this.dropped = new EventEmitter();
        this.updated = new EventEmitter();
        this.loadedNodes = new EventEmitter();
        this.loadedTreant = new EventEmitter();
        this.loadedTree = new EventEmitter();
    }
    ngAfterViewInit() {
        const callback = (callback) => {
            let popoverElm1;
            let popoverElm2;
            let timeout;
            let draggedNode;
            let droppedNode;
            const __this = this;
            // add ids to nodeDOMs
            for (let i = 0; i < callback.nodeDB.db.length; i++) {
                callback.nodeDB.db[i].nodeDOM.id = callback.nodeDB.db[i].id;
            }
            this.loadedTree.emit(callback);
            const $oNodes = $(`#${this.chartId} .node`);
            // add support for drag and drop functionality
            const addDragAndDropSupport = () => {
                for (let i = 0; i < $oNodes.length; i++) {
                    $oNodes[i].draggable = true;
                    $oNodes[i].classList.add('drop');
                    $oNodes[i].addEventListener('dragstart', drag, false);
                    $oNodes[i].addEventListener('drop', drop, false);
                    $oNodes[i].addEventListener('dragover', allowDrop, false);
                }
            };
            // swap nodes after drag and drop
            function swapNodes(nodes, dragIndex, dropIndex) {
                const temp = nodes[dragIndex];
                const dragClone = { ...temp };
                const dropClone = { ...nodes[dropIndex] };
                nodes[dragIndex] = nodes[dropIndex];
                nodes[dropIndex] = temp;
                // set dragged node props
                nodes[dragIndex].id = dragClone.id;
                nodes[dragIndex].nodeDOM.id = dragClone.id;
                nodes[dragIndex].parentId = dragClone.parentId;
                nodes[dragIndex].children = dragClone.children;
                nodes[dragIndex].connStyle = dragClone.connStyle;
                nodes[dragIndex].stackChildren = dragClone.stackChildren;
                nodes[dragIndex].stackParentId = dragClone.stackParentId;
                nodes[dragIndex].stackParent = dragClone.stackParent;
                nodes[dragIndex].leftNeighborId = dragClone.leftNeighborId;
                nodes[dragIndex].rightNeighborId = dragClone.rightNeighborId;
                nodes[dragIndex].collapsed = dragClone.collapsed;
                nodes[dragIndex].collapsable = dragClone.collapsable;
                // set dropped node props
                nodes[dropIndex].id = dropClone.id;
                nodes[dropIndex].nodeDOM.id = dropClone.id;
                nodes[dropIndex].parentId = dropClone.parentId;
                nodes[dropIndex].children = dropClone.children;
                nodes[dropIndex].connStyle = dropClone.connStyle;
                nodes[dropIndex].stackChildren = dropClone.stackChildren;
                nodes[dropIndex].stackParent = dropClone.stackParent;
                nodes[dropIndex].stackParentId = dropClone.stackParentId;
                nodes[dropIndex].leftNeighborId = dropClone.leftNeighborId;
                nodes[dropIndex].rightNeighborId = dropClone.rightNeighborId;
                nodes[dropIndex].collapsed = dropClone.collapsed;
                nodes[dropIndex].collapsable = dropClone.collapsable;
            }
            function hidePopover() {
                $(popoverElm1).popover('hide');
                $(popoverElm2).popover('hide');
            }
            function drag(event) {
                draggedNode = callback.nodeDB.db.find((n) => n.id == $(this).attr('id'));
                hidePopover();
                __this.dragged.emit({ draggedNode, $ });
            }
            function drop(event) {
                event.preventDefault();
                droppedNode = callback.nodeDB.db.find((n) => n.id == $(this).attr('id'));
                hidePopover();
                __this.dropped.emit({ draggedNode: droppedNode, droppedNode: draggedNode, $ });
                const dragIndex = callback.nodeDB.db.findIndex((n) => n.id == draggedNode.id);
                const dropIndex = callback.nodeDB.db.findIndex((n) => n.id == droppedNode.id);
                swapNodes(callback.nodeDB.db, dragIndex, dropIndex);
                callback.positionTree();
            }
            function allowDrop(event) {
                event.preventDefault();
            }
            function updateTextVal(currentEle, value, classVal, node, propName) {
                let isTextUpdated = false;
                $(document).off('click');
                $(currentEle).html('<input class="input-field" style="width:' +
                    $(currentEle).width() +
                    'px;" type="text" value="' +
                    value +
                    '"/>');
                $('.input-field').focus();
                $('.input-field').keyup(function (event) {
                    if (event.keyCode === 13) {
                        const inputClass = $(event.target).attr('class');
                        const newValue = $('.input-field').val() ? $('.input-field').val() : value;
                        $(currentEle).html('<p class="' + classVal + '">' + newValue + '</p>');
                        if (inputClass === 'input-field') {
                            isTextUpdated = true;
                        }
                        if (propName) {
                            node.text[propName] = newValue;
                            node.width = $(currentEle).width();
                        }
                        callback.positionTree();
                        __this.updated.emit({ node, $ });
                    }
                });
                $(document).click(function () {
                    if ($(event.target).attr('class') !== 'input-field' && !isTextUpdated) {
                        const newValue = $('.input-field').val() ? $('.input-field').val() : value;
                        $(currentEle).html('<p class="' + classVal + '">' + newValue + '</p>');
                        $(document).off('click');
                        if (propName) {
                            node.text[propName] = newValue;
                            node.width = $(currentEle).width();
                        }
                        callback.positionTree();
                        __this.updated.emit({ node, $ });
                    }
                });
            }
            this.isDraggable && addDragAndDropSupport();
            $oNodes.off('click').on('click', function (event) {
                const node = callback.nodeDB.db.find((n) => n.id == $(this).attr('id'));
                hidePopover();
                __this.clicked.emit({ node, $ });
            });
            $oNodes.off('dblclick').on('dblclick', function (e) {
                if ($(event.target).attr('class') !== 'input-field') {
                    e.stopPropagation();
                    const node = callback.nodeDB.db.find((n) => n.id == $(this).attr('id'));
                    const currentEle = $(event.target);
                    const value = $(event.target).text();
                    const classVal = $(event.target).attr('class');
                    const propName = classVal && classVal.split('-')[1];
                    hidePopover();
                    node.text &&
                        node.text[propName] &&
                        updateTextVal(currentEle, value, classVal, node, propName);
                }
            });
            if (this.popoverSettings) {
                $oNodes.popover(this.popoverSettings);
                $oNodes
                    .off('mouseenter')
                    .on('mouseenter', function (e) {
                    hidePopover();
                    popoverElm1 = this;
                    $(this).popover('show');
                    const node = callback.nodeDB.db.find((n) => n.id == $(this).attr('id'));
                    __this.hovered.emit({ node, $ });
                    clearTimeout(timeout);
                    $('.popover')
                        .off('mouseleave')
                        .on('mouseleave', function () {
                        hidePopover();
                    });
                })
                    .off('mouseleave')
                    .on('mouseleave', function (e) {
                    let hovered = false;
                    popoverElm2 = this;
                    $('.popover').hover(function () {
                        hovered = true;
                    }, function () {
                        hovered = false;
                    });
                    if (!$('.popover:hover').length) {
                        timeout = setTimeout(() => {
                            !hovered && hidePopover();
                        }, __this.mouseleaveMilliseconds || 0);
                    }
                });
            }
            // emit Tree nodes
            this.loadedNodes.emit({ nodes: callback.nodeDB.db, $ });
        };
        // create Treant instance and add its container ID
        // this instance can be useful to operate on the Tree
        const treant = new Treant(this.data, callback, $);
        treant.container_id = this.chartId;
        this.loadedTreant.emit(treant);
    }
    static { this.ɵfac = function NgxTreantJsComponent_Factory(t) { return new (t || NgxTreantJsComponent)(); }; }
    static { this.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: NgxTreantJsComponent, selectors: [["ngx-treant-chart"]], inputs: { chartId: "chartId", chartClass: "chartClass", data: "data", popoverSettings: "popoverSettings", mouseleaveMilliseconds: "mouseleaveMilliseconds", isDraggable: "isDraggable", textProps: "textProps" }, outputs: { clicked: "clicked", hovered: "hovered", dragged: "dragged", dropped: "dropped", updated: "updated", loadedNodes: "loadedNodes", loadedTreant: "loadedTreant", loadedTree: "loadedTree" }, decls: 1, vars: 2, consts: [[3, "className", "id"]], template: function NgxTreantJsComponent_Template(rf, ctx) { if (rf & 1) {
            i0.ɵɵelement(0, "div", 0);
        } if (rf & 2) {
            i0.ɵɵproperty("className", ctx.chartClass)("id", ctx.chartId);
        } }, encapsulation: 2 }); }
}
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(NgxTreantJsComponent, [{
        type: Component,
        args: [{ selector: 'ngx-treant-chart', template: "<div [className]=\"chartClass\" [id]=\"chartId\"></div>\n" }]
    }], function () { return []; }, { chartId: [{
            type: Input
        }], chartClass: [{
            type: Input
        }], data: [{
            type: Input
        }], popoverSettings: [{
            type: Input
        }], mouseleaveMilliseconds: [{
            type: Input
        }], isDraggable: [{
            type: Input
        }], textProps: [{
            type: Input
        }], clicked: [{
            type: Output
        }], hovered: [{
            type: Output
        }], dragged: [{
            type: Output
        }], dropped: [{
            type: Output
        }], updated: [{
            type: Output
        }], loadedNodes: [{
            type: Output
        }], loadedTreant: [{
            type: Output
        }], loadedTree: [{
            type: Output
        }] }); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXRyZWFudC1qcy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvbGliL25neC10cmVhbnQtanMuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vc3JjL2xpYi9uZ3gtdHJlYW50LWpzLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQWlCLEtBQUssRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDOztBQUt0Rjs7O0dBR0c7QUFLSCxNQUFNLE9BQU8sb0JBQW9CO0lBb0I3QjtRQVZVLFlBQU8sR0FBc0IsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNoRCxZQUFPLEdBQXNCLElBQUksWUFBWSxFQUFFLENBQUM7UUFDaEQsWUFBTyxHQUFzQixJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ2hELFlBQU8sR0FBc0IsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNoRCxZQUFPLEdBQXNCLElBQUksWUFBWSxFQUFFLENBQUM7UUFFaEQsZ0JBQVcsR0FBc0IsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNwRCxpQkFBWSxHQUFzQixJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ3JELGVBQVUsR0FBc0IsSUFBSSxZQUFZLEVBQUUsQ0FBQztJQUU5QyxDQUFDO0lBRWhCLGVBQWU7UUFDWCxNQUFNLFFBQVEsR0FBRyxDQUFDLFFBQWEsRUFBRSxFQUFFO1lBQy9CLElBQUksV0FBVyxDQUFDO1lBQ2hCLElBQUksV0FBVyxDQUFDO1lBQ2hCLElBQUksT0FBTyxDQUFDO1lBQ1osSUFBSSxXQUFXLENBQUM7WUFDaEIsSUFBSSxXQUFXLENBQUM7WUFFaEIsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDO1lBRXBCLHNCQUFzQjtZQUN0QixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO2dCQUNoRCxRQUFRLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsRUFBRSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQzthQUMvRDtZQUVELElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBRS9CLE1BQU0sT0FBTyxHQUFHLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQyxPQUFPLFFBQVEsQ0FBQyxDQUFDO1lBRTVDLDhDQUE4QztZQUM5QyxNQUFNLHFCQUFxQixHQUFHLEdBQUcsRUFBRTtnQkFDL0IsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7b0JBQ3JDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDO29CQUM1QixPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztvQkFDakMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLGdCQUFnQixDQUFDLFdBQVcsRUFBRSxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUM7b0JBQ3RELE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO29CQUNqRCxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxFQUFFLFNBQVMsRUFBRSxLQUFLLENBQUMsQ0FBQztpQkFDN0Q7WUFDTCxDQUFDLENBQUM7WUFFRixpQ0FBaUM7WUFDakMsU0FBUyxTQUFTLENBQUMsS0FBSyxFQUFFLFNBQVMsRUFBRSxTQUFTO2dCQUMxQyxNQUFNLElBQUksR0FBRyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUM7Z0JBQzlCLE1BQU0sU0FBUyxHQUFHLEVBQUUsR0FBRyxJQUFJLEVBQUUsQ0FBQztnQkFDOUIsTUFBTSxTQUFTLEdBQUcsRUFBRSxHQUFHLEtBQUssQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDO2dCQUUxQyxLQUFLLENBQUMsU0FBUyxDQUFDLEdBQUcsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDO2dCQUNwQyxLQUFLLENBQUMsU0FBUyxDQUFDLEdBQUcsSUFBSSxDQUFDO2dCQUV4Qix5QkFBeUI7Z0JBQ3pCLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLEdBQUcsU0FBUyxDQUFDLEVBQUUsQ0FBQztnQkFDbkMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLEdBQUcsU0FBUyxDQUFDLEVBQUUsQ0FBQztnQkFDM0MsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLFFBQVEsR0FBRyxTQUFTLENBQUMsUUFBUSxDQUFDO2dCQUMvQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsUUFBUSxHQUFHLFNBQVMsQ0FBQyxRQUFRLENBQUM7Z0JBQy9DLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDLFNBQVMsQ0FBQztnQkFDakQsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLGFBQWEsR0FBRyxTQUFTLENBQUMsYUFBYSxDQUFDO2dCQUN6RCxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsYUFBYSxHQUFHLFNBQVMsQ0FBQyxhQUFhLENBQUM7Z0JBQ3pELEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQyxXQUFXLEdBQUcsU0FBUyxDQUFDLFdBQVcsQ0FBQztnQkFDckQsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLGNBQWMsR0FBRyxTQUFTLENBQUMsY0FBYyxDQUFDO2dCQUMzRCxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsZUFBZSxHQUFHLFNBQVMsQ0FBQyxlQUFlLENBQUM7Z0JBQzdELEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDLFNBQVMsQ0FBQztnQkFDakQsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLFdBQVcsR0FBRyxTQUFTLENBQUMsV0FBVyxDQUFDO2dCQUVyRCx5QkFBeUI7Z0JBQ3pCLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLEdBQUcsU0FBUyxDQUFDLEVBQUUsQ0FBQztnQkFDbkMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLEdBQUcsU0FBUyxDQUFDLEVBQUUsQ0FBQztnQkFDM0MsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLFFBQVEsR0FBRyxTQUFTLENBQUMsUUFBUSxDQUFDO2dCQUMvQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsUUFBUSxHQUFHLFNBQVMsQ0FBQyxRQUFRLENBQUM7Z0JBQy9DLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDLFNBQVMsQ0FBQztnQkFDakQsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLGFBQWEsR0FBRyxTQUFTLENBQUMsYUFBYSxDQUFDO2dCQUN6RCxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQyxXQUFXLENBQUM7Z0JBQ3JELEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQyxhQUFhLEdBQUcsU0FBUyxDQUFDLGFBQWEsQ0FBQztnQkFDekQsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLGNBQWMsR0FBRyxTQUFTLENBQUMsY0FBYyxDQUFDO2dCQUMzRCxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsZUFBZSxHQUFHLFNBQVMsQ0FBQyxlQUFlLENBQUM7Z0JBQzdELEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDLFNBQVMsQ0FBQztnQkFDakQsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLFdBQVcsR0FBRyxTQUFTLENBQUMsV0FBVyxDQUFDO1lBQ3pELENBQUM7WUFFRCxTQUFTLFdBQVc7Z0JBQ2hCLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQy9CLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDbkMsQ0FBQztZQUVELFNBQVMsSUFBSSxDQUFDLEtBQUs7Z0JBQ2YsV0FBVyxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBRXpFLFdBQVcsRUFBRSxDQUFDO2dCQUVkLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsV0FBVyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDNUMsQ0FBQztZQUVELFNBQVMsSUFBSSxDQUFDLEtBQUs7Z0JBQ2YsS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFDO2dCQUN2QixXQUFXLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztnQkFFekUsV0FBVyxFQUFFLENBQUM7Z0JBRWQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxXQUFXLEVBQUUsV0FBVyxFQUFFLFdBQVcsRUFBRSxXQUFXLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFFL0UsTUFBTSxTQUFTLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLFdBQVcsQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDOUUsTUFBTSxTQUFTLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLFdBQVcsQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFFOUUsU0FBUyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLFNBQVMsRUFBRSxTQUFTLENBQUMsQ0FBQztnQkFFcEQsUUFBUSxDQUFDLFlBQVksRUFBRSxDQUFDO1lBQzVCLENBQUM7WUFFRCxTQUFTLFNBQVMsQ0FBQyxLQUFLO2dCQUNwQixLQUFLLENBQUMsY0FBYyxFQUFFLENBQUM7WUFDM0IsQ0FBQztZQUVELFNBQVMsYUFBYSxDQUFDLFVBQVUsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxRQUFRO2dCQUM5RCxJQUFJLGFBQWEsR0FBRyxLQUFLLENBQUM7Z0JBRTFCLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQ3pCLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQ2QsMENBQTBDO29CQUN0QyxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsS0FBSyxFQUFFO29CQUNyQiwwQkFBMEI7b0JBQzFCLEtBQUs7b0JBQ0wsS0FBSyxDQUNaLENBQUM7Z0JBQ0YsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDO2dCQUMxQixDQUFDLENBQUMsY0FBYyxDQUFDLENBQUMsS0FBSyxDQUFDLFVBQVUsS0FBSztvQkFDbkMsSUFBSSxLQUFLLENBQUMsT0FBTyxLQUFLLEVBQUUsRUFBRTt3QkFDdEIsTUFBTSxVQUFVLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7d0JBQ2pELE1BQU0sUUFBUSxHQUFHLENBQUMsQ0FBQyxjQUFjLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7d0JBRTNFLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxHQUFHLFFBQVEsR0FBRyxJQUFJLEdBQUcsUUFBUSxHQUFHLE1BQU0sQ0FBQyxDQUFDO3dCQUN2RSxJQUFJLFVBQVUsS0FBSyxhQUFhLEVBQUU7NEJBQzlCLGFBQWEsR0FBRyxJQUFJLENBQUM7eUJBQ3hCO3dCQUVELElBQUksUUFBUSxFQUFFOzRCQUNWLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsUUFBUSxDQUFDOzRCQUMvQixJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQzt5QkFDdEM7d0JBRUQsUUFBUSxDQUFDLFlBQVksRUFBRSxDQUFDO3dCQUV4QixNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO3FCQUNwQztnQkFDTCxDQUFDLENBQUMsQ0FBQztnQkFFSCxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsS0FBSyxDQUFDO29CQUNkLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssYUFBYSxJQUFJLENBQUMsYUFBYSxFQUFFO3dCQUNuRSxNQUFNLFFBQVEsR0FBRyxDQUFDLENBQUMsY0FBYyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxjQUFjLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO3dCQUUzRSxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksR0FBRyxRQUFRLEdBQUcsSUFBSSxHQUFHLFFBQVEsR0FBRyxNQUFNLENBQUMsQ0FBQzt3QkFDdkUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQzt3QkFFekIsSUFBSSxRQUFRLEVBQUU7NEJBQ1YsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxRQUFRLENBQUM7NEJBQy9CLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDO3lCQUN0Qzt3QkFFRCxRQUFRLENBQUMsWUFBWSxFQUFFLENBQUM7d0JBRXhCLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7cUJBQ3BDO2dCQUNMLENBQUMsQ0FBQyxDQUFDO1lBQ1AsQ0FBQztZQUVELElBQUksQ0FBQyxXQUFXLElBQUkscUJBQXFCLEVBQUUsQ0FBQztZQUU1QyxPQUFPLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxPQUFPLEVBQUUsVUFBVSxLQUFLO2dCQUM1QyxNQUFNLElBQUksR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO2dCQUV4RSxXQUFXLEVBQUUsQ0FBQztnQkFFZCxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ3JDLENBQUMsQ0FBQyxDQUFDO1lBRUgsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQyxFQUFFLENBQUMsVUFBVSxFQUFFLFVBQVUsQ0FBQztnQkFDOUMsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxhQUFhLEVBQUU7b0JBQ2pELENBQUMsQ0FBQyxlQUFlLEVBQUUsQ0FBQztvQkFDcEIsTUFBTSxJQUFJLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztvQkFDeEUsTUFBTSxVQUFVLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztvQkFDbkMsTUFBTSxLQUFLLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztvQkFDckMsTUFBTSxRQUFRLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7b0JBQy9DLE1BQU0sUUFBUSxHQUFHLFFBQVEsSUFBSSxRQUFRLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUVwRCxXQUFXLEVBQUUsQ0FBQztvQkFFZCxJQUFJLENBQUMsSUFBSTt3QkFDTCxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQzt3QkFDbkIsYUFBYSxDQUFDLFVBQVUsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQztpQkFDbEU7WUFDTCxDQUFDLENBQUMsQ0FBQztZQUVILElBQUksSUFBSSxDQUFDLGVBQWUsRUFBRTtnQkFDdEIsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7Z0JBQ3RDLE9BQU87cUJBQ0YsR0FBRyxDQUFDLFlBQVksQ0FBQztxQkFDakIsRUFBRSxDQUFDLFlBQVksRUFBRSxVQUFVLENBQUM7b0JBQ3pCLFdBQVcsRUFBRSxDQUFDO29CQUVkLFdBQVcsR0FBRyxJQUFJLENBQUM7b0JBRW5CLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7b0JBRXhCLE1BQU0sSUFBSSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7b0JBQ3hFLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7b0JBRWpDLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQztvQkFFdEIsQ0FBQyxDQUFDLFVBQVUsQ0FBQzt5QkFDUixHQUFHLENBQUMsWUFBWSxDQUFDO3lCQUNqQixFQUFFLENBQUMsWUFBWSxFQUFFO3dCQUNkLFdBQVcsRUFBRSxDQUFDO29CQUNsQixDQUFDLENBQUMsQ0FBQztnQkFDWCxDQUFDLENBQUM7cUJBQ0QsR0FBRyxDQUFDLFlBQVksQ0FBQztxQkFDakIsRUFBRSxDQUFDLFlBQVksRUFBRSxVQUFVLENBQUM7b0JBQ3pCLElBQUksT0FBTyxHQUFHLEtBQUssQ0FBQztvQkFDcEIsV0FBVyxHQUFHLElBQUksQ0FBQztvQkFFbkIsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLEtBQUssQ0FDZjt3QkFDSSxPQUFPLEdBQUcsSUFBSSxDQUFDO29CQUNuQixDQUFDLEVBQ0Q7d0JBQ0ksT0FBTyxHQUFHLEtBQUssQ0FBQztvQkFDcEIsQ0FBQyxDQUNKLENBQUM7b0JBRUYsSUFBSSxDQUFDLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLE1BQU0sRUFBRTt3QkFDN0IsT0FBTyxHQUFHLFVBQVUsQ0FBQyxHQUFHLEVBQUU7NEJBQ3RCLENBQUMsT0FBTyxJQUFJLFdBQVcsRUFBRSxDQUFDO3dCQUM5QixDQUFDLEVBQUUsTUFBTSxDQUFDLHNCQUFzQixJQUFJLENBQUMsQ0FBQyxDQUFDO3FCQUMxQztnQkFDTCxDQUFDLENBQUMsQ0FBQzthQUNWO1lBRUQsa0JBQWtCO1lBQ2xCLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxFQUFFLFFBQVEsQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDNUQsQ0FBQyxDQUFDO1FBRUYsa0RBQWtEO1FBQ2xELHFEQUFxRDtRQUNyRCxNQUFNLE1BQU0sR0FBRyxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNsRCxNQUFNLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7UUFDbkMsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDbkMsQ0FBQztxRkEvUFEsb0JBQW9CO29FQUFwQixvQkFBb0I7WUNiakMseUJBQW1EOztZQUE5QywwQ0FBd0IsbUJBQUE7Ozt1RkRhaEIsb0JBQW9CO2NBSmhDLFNBQVM7MkJBQ0ksa0JBQWtCO3NDQUluQixPQUFPO2tCQUFmLEtBQUs7WUFDRyxVQUFVO2tCQUFsQixLQUFLO1lBRUcsSUFBSTtrQkFBWixLQUFLO1lBQ0csZUFBZTtrQkFBdkIsS0FBSztZQUNHLHNCQUFzQjtrQkFBOUIsS0FBSztZQUNHLFdBQVc7a0JBQW5CLEtBQUs7WUFDRyxTQUFTO2tCQUFqQixLQUFLO1lBRUksT0FBTztrQkFBaEIsTUFBTTtZQUNHLE9BQU87a0JBQWhCLE1BQU07WUFDRyxPQUFPO2tCQUFoQixNQUFNO1lBQ0csT0FBTztrQkFBaEIsTUFBTTtZQUNHLE9BQU87a0JBQWhCLE1BQU07WUFFRyxXQUFXO2tCQUFwQixNQUFNO1lBQ0csWUFBWTtrQkFBckIsTUFBTTtZQUNHLFVBQVU7a0JBQW5CLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIEFmdGVyVmlld0luaXQsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5kZWNsYXJlIGNvbnN0IFRyZWFudDogYW55O1xuZGVjbGFyZSBjb25zdCAkOiBhbnk7XG5cbi8qKlxuICogQSBzaW1wbGUgQW5ndWxhcjIrIGNvbXBvbmVudCB1c2VkIGFzIGEgd3JhcHBlciBmb3IgW1RyZWFudEpTXShodHRwczovL2ZwZXJ1Y2ljLmdpdGh1Yi5pby90cmVhbnQtanMvKSBsaWJyYXJ5XG4gKiBmb3IgdmlzdWFsaXphdGlvbiBvZiB0cmVlIChjaGFydCkgZGlhZ3JhbXMsIHdpdGggYWRkaXRpb25hbCBmdW5jdGlvbmFsaXR5LlxuICovXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ25neC10cmVhbnQtY2hhcnQnLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9uZ3gtdHJlYW50LWpzLmNvbXBvbmVudC5odG1sJyxcbn0pXG5leHBvcnQgY2xhc3MgTmd4VHJlYW50SnNDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0IHtcbiAgICBASW5wdXQoKSBjaGFydElkOiBzdHJpbmc7XG4gICAgQElucHV0KCkgY2hhcnRDbGFzczogc3RyaW5nO1xuXG4gICAgQElucHV0KCkgZGF0YTogYW55O1xuICAgIEBJbnB1dCgpIHBvcG92ZXJTZXR0aW5nczogYW55O1xuICAgIEBJbnB1dCgpIG1vdXNlbGVhdmVNaWxsaXNlY29uZHM6IG51bWJlcjtcbiAgICBASW5wdXQoKSBpc0RyYWdnYWJsZTogYm9vbGVhbjtcbiAgICBASW5wdXQoKSB0ZXh0UHJvcHM6IGFueTtcblxuICAgIEBPdXRwdXQoKSBjbGlja2VkOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICBAT3V0cHV0KCkgaG92ZXJlZDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgQE91dHB1dCgpIGRyYWdnZWQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgIEBPdXRwdXQoKSBkcm9wcGVkOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICBAT3V0cHV0KCkgdXBkYXRlZDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgICBAT3V0cHV0KCkgbG9hZGVkTm9kZXM6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgIEBPdXRwdXQoKSBsb2FkZWRUcmVhbnQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgIEBPdXRwdXQoKSBsb2FkZWRUcmVlOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAgIGNvbnN0cnVjdG9yKCkge31cblxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgY2FsbGJhY2sgPSAoY2FsbGJhY2s6IGFueSkgPT4ge1xuICAgICAgICAgICAgbGV0IHBvcG92ZXJFbG0xO1xuICAgICAgICAgICAgbGV0IHBvcG92ZXJFbG0yO1xuICAgICAgICAgICAgbGV0IHRpbWVvdXQ7XG4gICAgICAgICAgICBsZXQgZHJhZ2dlZE5vZGU7XG4gICAgICAgICAgICBsZXQgZHJvcHBlZE5vZGU7XG5cbiAgICAgICAgICAgIGNvbnN0IF9fdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgICAgIC8vIGFkZCBpZHMgdG8gbm9kZURPTXNcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2FsbGJhY2subm9kZURCLmRiLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2subm9kZURCLmRiW2ldLm5vZGVET00uaWQgPSBjYWxsYmFjay5ub2RlREIuZGJbaV0uaWQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMubG9hZGVkVHJlZS5lbWl0KGNhbGxiYWNrKTtcblxuICAgICAgICAgICAgY29uc3QgJG9Ob2RlcyA9ICQoYCMke3RoaXMuY2hhcnRJZH0gLm5vZGVgKTtcblxuICAgICAgICAgICAgLy8gYWRkIHN1cHBvcnQgZm9yIGRyYWcgYW5kIGRyb3AgZnVuY3Rpb25hbGl0eVxuICAgICAgICAgICAgY29uc3QgYWRkRHJhZ0FuZERyb3BTdXBwb3J0ID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgJG9Ob2Rlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAkb05vZGVzW2ldLmRyYWdnYWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICRvTm9kZXNbaV0uY2xhc3NMaXN0LmFkZCgnZHJvcCcpO1xuICAgICAgICAgICAgICAgICAgICAkb05vZGVzW2ldLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdzdGFydCcsIGRyYWcsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgJG9Ob2Rlc1tpXS5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgZHJvcCwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAkb05vZGVzW2ldLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdvdmVyJywgYWxsb3dEcm9wLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLy8gc3dhcCBub2RlcyBhZnRlciBkcmFnIGFuZCBkcm9wXG4gICAgICAgICAgICBmdW5jdGlvbiBzd2FwTm9kZXMobm9kZXMsIGRyYWdJbmRleCwgZHJvcEluZGV4KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGVtcCA9IG5vZGVzW2RyYWdJbmRleF07XG4gICAgICAgICAgICAgICAgY29uc3QgZHJhZ0Nsb25lID0geyAuLi50ZW1wIH07XG4gICAgICAgICAgICAgICAgY29uc3QgZHJvcENsb25lID0geyAuLi5ub2Rlc1tkcm9wSW5kZXhdIH07XG5cbiAgICAgICAgICAgICAgICBub2Rlc1tkcmFnSW5kZXhdID0gbm9kZXNbZHJvcEluZGV4XTtcbiAgICAgICAgICAgICAgICBub2Rlc1tkcm9wSW5kZXhdID0gdGVtcDtcblxuICAgICAgICAgICAgICAgIC8vIHNldCBkcmFnZ2VkIG5vZGUgcHJvcHNcbiAgICAgICAgICAgICAgICBub2Rlc1tkcmFnSW5kZXhdLmlkID0gZHJhZ0Nsb25lLmlkO1xuICAgICAgICAgICAgICAgIG5vZGVzW2RyYWdJbmRleF0ubm9kZURPTS5pZCA9IGRyYWdDbG9uZS5pZDtcbiAgICAgICAgICAgICAgICBub2Rlc1tkcmFnSW5kZXhdLnBhcmVudElkID0gZHJhZ0Nsb25lLnBhcmVudElkO1xuICAgICAgICAgICAgICAgIG5vZGVzW2RyYWdJbmRleF0uY2hpbGRyZW4gPSBkcmFnQ2xvbmUuY2hpbGRyZW47XG4gICAgICAgICAgICAgICAgbm9kZXNbZHJhZ0luZGV4XS5jb25uU3R5bGUgPSBkcmFnQ2xvbmUuY29ublN0eWxlO1xuICAgICAgICAgICAgICAgIG5vZGVzW2RyYWdJbmRleF0uc3RhY2tDaGlsZHJlbiA9IGRyYWdDbG9uZS5zdGFja0NoaWxkcmVuO1xuICAgICAgICAgICAgICAgIG5vZGVzW2RyYWdJbmRleF0uc3RhY2tQYXJlbnRJZCA9IGRyYWdDbG9uZS5zdGFja1BhcmVudElkO1xuICAgICAgICAgICAgICAgIG5vZGVzW2RyYWdJbmRleF0uc3RhY2tQYXJlbnQgPSBkcmFnQ2xvbmUuc3RhY2tQYXJlbnQ7XG4gICAgICAgICAgICAgICAgbm9kZXNbZHJhZ0luZGV4XS5sZWZ0TmVpZ2hib3JJZCA9IGRyYWdDbG9uZS5sZWZ0TmVpZ2hib3JJZDtcbiAgICAgICAgICAgICAgICBub2Rlc1tkcmFnSW5kZXhdLnJpZ2h0TmVpZ2hib3JJZCA9IGRyYWdDbG9uZS5yaWdodE5laWdoYm9ySWQ7XG4gICAgICAgICAgICAgICAgbm9kZXNbZHJhZ0luZGV4XS5jb2xsYXBzZWQgPSBkcmFnQ2xvbmUuY29sbGFwc2VkO1xuICAgICAgICAgICAgICAgIG5vZGVzW2RyYWdJbmRleF0uY29sbGFwc2FibGUgPSBkcmFnQ2xvbmUuY29sbGFwc2FibGU7XG5cbiAgICAgICAgICAgICAgICAvLyBzZXQgZHJvcHBlZCBub2RlIHByb3BzXG4gICAgICAgICAgICAgICAgbm9kZXNbZHJvcEluZGV4XS5pZCA9IGRyb3BDbG9uZS5pZDtcbiAgICAgICAgICAgICAgICBub2Rlc1tkcm9wSW5kZXhdLm5vZGVET00uaWQgPSBkcm9wQ2xvbmUuaWQ7XG4gICAgICAgICAgICAgICAgbm9kZXNbZHJvcEluZGV4XS5wYXJlbnRJZCA9IGRyb3BDbG9uZS5wYXJlbnRJZDtcbiAgICAgICAgICAgICAgICBub2Rlc1tkcm9wSW5kZXhdLmNoaWxkcmVuID0gZHJvcENsb25lLmNoaWxkcmVuO1xuICAgICAgICAgICAgICAgIG5vZGVzW2Ryb3BJbmRleF0uY29ublN0eWxlID0gZHJvcENsb25lLmNvbm5TdHlsZTtcbiAgICAgICAgICAgICAgICBub2Rlc1tkcm9wSW5kZXhdLnN0YWNrQ2hpbGRyZW4gPSBkcm9wQ2xvbmUuc3RhY2tDaGlsZHJlbjtcbiAgICAgICAgICAgICAgICBub2Rlc1tkcm9wSW5kZXhdLnN0YWNrUGFyZW50ID0gZHJvcENsb25lLnN0YWNrUGFyZW50O1xuICAgICAgICAgICAgICAgIG5vZGVzW2Ryb3BJbmRleF0uc3RhY2tQYXJlbnRJZCA9IGRyb3BDbG9uZS5zdGFja1BhcmVudElkO1xuICAgICAgICAgICAgICAgIG5vZGVzW2Ryb3BJbmRleF0ubGVmdE5laWdoYm9ySWQgPSBkcm9wQ2xvbmUubGVmdE5laWdoYm9ySWQ7XG4gICAgICAgICAgICAgICAgbm9kZXNbZHJvcEluZGV4XS5yaWdodE5laWdoYm9ySWQgPSBkcm9wQ2xvbmUucmlnaHROZWlnaGJvcklkO1xuICAgICAgICAgICAgICAgIG5vZGVzW2Ryb3BJbmRleF0uY29sbGFwc2VkID0gZHJvcENsb25lLmNvbGxhcHNlZDtcbiAgICAgICAgICAgICAgICBub2Rlc1tkcm9wSW5kZXhdLmNvbGxhcHNhYmxlID0gZHJvcENsb25lLmNvbGxhcHNhYmxlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBoaWRlUG9wb3ZlcigpIHtcbiAgICAgICAgICAgICAgICAkKHBvcG92ZXJFbG0xKS5wb3BvdmVyKCdoaWRlJyk7XG4gICAgICAgICAgICAgICAgJChwb3BvdmVyRWxtMikucG9wb3ZlcignaGlkZScpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBkcmFnKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgZHJhZ2dlZE5vZGUgPSBjYWxsYmFjay5ub2RlREIuZGIuZmluZCgobikgPT4gbi5pZCA9PSAkKHRoaXMpLmF0dHIoJ2lkJykpO1xuXG4gICAgICAgICAgICAgICAgaGlkZVBvcG92ZXIoKTtcblxuICAgICAgICAgICAgICAgIF9fdGhpcy5kcmFnZ2VkLmVtaXQoeyBkcmFnZ2VkTm9kZSwgJCB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZHJvcChldmVudCkge1xuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgZHJvcHBlZE5vZGUgPSBjYWxsYmFjay5ub2RlREIuZGIuZmluZCgobikgPT4gbi5pZCA9PSAkKHRoaXMpLmF0dHIoJ2lkJykpO1xuXG4gICAgICAgICAgICAgICAgaGlkZVBvcG92ZXIoKTtcblxuICAgICAgICAgICAgICAgIF9fdGhpcy5kcm9wcGVkLmVtaXQoeyBkcmFnZ2VkTm9kZTogZHJvcHBlZE5vZGUsIGRyb3BwZWROb2RlOiBkcmFnZ2VkTm9kZSwgJCB9KTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IGRyYWdJbmRleCA9IGNhbGxiYWNrLm5vZGVEQi5kYi5maW5kSW5kZXgoKG4pID0+IG4uaWQgPT0gZHJhZ2dlZE5vZGUuaWQpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGRyb3BJbmRleCA9IGNhbGxiYWNrLm5vZGVEQi5kYi5maW5kSW5kZXgoKG4pID0+IG4uaWQgPT0gZHJvcHBlZE5vZGUuaWQpO1xuXG4gICAgICAgICAgICAgICAgc3dhcE5vZGVzKGNhbGxiYWNrLm5vZGVEQi5kYiwgZHJhZ0luZGV4LCBkcm9wSW5kZXgpO1xuXG4gICAgICAgICAgICAgICAgY2FsbGJhY2sucG9zaXRpb25UcmVlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGFsbG93RHJvcChldmVudCkge1xuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVRleHRWYWwoY3VycmVudEVsZSwgdmFsdWUsIGNsYXNzVmFsLCBub2RlLCBwcm9wTmFtZSkge1xuICAgICAgICAgICAgICAgIGxldCBpc1RleHRVcGRhdGVkID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAkKGRvY3VtZW50KS5vZmYoJ2NsaWNrJyk7XG4gICAgICAgICAgICAgICAgJChjdXJyZW50RWxlKS5odG1sKFxuICAgICAgICAgICAgICAgICAgICAnPGlucHV0IGNsYXNzPVwiaW5wdXQtZmllbGRcIiBzdHlsZT1cIndpZHRoOicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgJChjdXJyZW50RWxlKS53aWR0aCgpICtcbiAgICAgICAgICAgICAgICAgICAgICAgICdweDtcIiB0eXBlPVwidGV4dFwiIHZhbHVlPVwiJyArXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSArXG4gICAgICAgICAgICAgICAgICAgICAgICAnXCIvPidcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICQoJy5pbnB1dC1maWVsZCcpLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgJCgnLmlucHV0LWZpZWxkJykua2V5dXAoZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5rZXlDb2RlID09PSAxMykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5wdXRDbGFzcyA9ICQoZXZlbnQudGFyZ2V0KS5hdHRyKCdjbGFzcycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3VmFsdWUgPSAkKCcuaW5wdXQtZmllbGQnKS52YWwoKSA/ICQoJy5pbnB1dC1maWVsZCcpLnZhbCgpIDogdmFsdWU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICQoY3VycmVudEVsZSkuaHRtbCgnPHAgY2xhc3M9XCInICsgY2xhc3NWYWwgKyAnXCI+JyArIG5ld1ZhbHVlICsgJzwvcD4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dENsYXNzID09PSAnaW5wdXQtZmllbGQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNUZXh0VXBkYXRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9wTmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUudGV4dFtwcm9wTmFtZV0gPSBuZXdWYWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlLndpZHRoID0gJChjdXJyZW50RWxlKS53aWR0aCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5wb3NpdGlvblRyZWUoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLnVwZGF0ZWQuZW1pdCh7IG5vZGUsICQgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCQoZXZlbnQudGFyZ2V0KS5hdHRyKCdjbGFzcycpICE9PSAnaW5wdXQtZmllbGQnICYmICFpc1RleHRVcGRhdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdWYWx1ZSA9ICQoJy5pbnB1dC1maWVsZCcpLnZhbCgpID8gJCgnLmlucHV0LWZpZWxkJykudmFsKCkgOiB2YWx1ZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgJChjdXJyZW50RWxlKS5odG1sKCc8cCBjbGFzcz1cIicgKyBjbGFzc1ZhbCArICdcIj4nICsgbmV3VmFsdWUgKyAnPC9wPicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJChkb2N1bWVudCkub2ZmKCdjbGljaycpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvcE5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlLnRleHRbcHJvcE5hbWVdID0gbmV3VmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS53aWR0aCA9ICQoY3VycmVudEVsZSkud2lkdGgoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sucG9zaXRpb25UcmVlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy51cGRhdGVkLmVtaXQoeyBub2RlLCAkIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuaXNEcmFnZ2FibGUgJiYgYWRkRHJhZ0FuZERyb3BTdXBwb3J0KCk7XG5cbiAgICAgICAgICAgICRvTm9kZXMub2ZmKCdjbGljaycpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBjYWxsYmFjay5ub2RlREIuZGIuZmluZCgobikgPT4gbi5pZCA9PSAkKHRoaXMpLmF0dHIoJ2lkJykpO1xuXG4gICAgICAgICAgICAgICAgaGlkZVBvcG92ZXIoKTtcblxuICAgICAgICAgICAgICAgIF9fdGhpcy5jbGlja2VkLmVtaXQoeyBub2RlLCAkIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICRvTm9kZXMub2ZmKCdkYmxjbGljaycpLm9uKCdkYmxjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCQoZXZlbnQudGFyZ2V0KS5hdHRyKCdjbGFzcycpICE9PSAnaW5wdXQtZmllbGQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vZGUgPSBjYWxsYmFjay5ub2RlREIuZGIuZmluZCgobikgPT4gbi5pZCA9PSAkKHRoaXMpLmF0dHIoJ2lkJykpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50RWxlID0gJChldmVudC50YXJnZXQpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9ICQoZXZlbnQudGFyZ2V0KS50ZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNsYXNzVmFsID0gJChldmVudC50YXJnZXQpLmF0dHIoJ2NsYXNzJyk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb3BOYW1lID0gY2xhc3NWYWwgJiYgY2xhc3NWYWwuc3BsaXQoJy0nKVsxXTtcblxuICAgICAgICAgICAgICAgICAgICBoaWRlUG9wb3ZlcigpO1xuXG4gICAgICAgICAgICAgICAgICAgIG5vZGUudGV4dCAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS50ZXh0W3Byb3BOYW1lXSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlVGV4dFZhbChjdXJyZW50RWxlLCB2YWx1ZSwgY2xhc3NWYWwsIG5vZGUsIHByb3BOYW1lKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKHRoaXMucG9wb3ZlclNldHRpbmdzKSB7XG4gICAgICAgICAgICAgICAgJG9Ob2Rlcy5wb3BvdmVyKHRoaXMucG9wb3ZlclNldHRpbmdzKTtcbiAgICAgICAgICAgICAgICAkb05vZGVzXG4gICAgICAgICAgICAgICAgICAgIC5vZmYoJ21vdXNlZW50ZXInKVxuICAgICAgICAgICAgICAgICAgICAub24oJ21vdXNlZW50ZXInLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaGlkZVBvcG92ZXIoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcG9wb3ZlckVsbTEgPSB0aGlzO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnBvcG92ZXIoJ3Nob3cnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgbm9kZSA9IGNhbGxiYWNrLm5vZGVEQi5kYi5maW5kKChuKSA9PiBuLmlkID09ICQodGhpcykuYXR0cignaWQnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMuaG92ZXJlZC5lbWl0KHsgbm9kZSwgJCB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcucG9wb3ZlcicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLm9mZignbW91c2VsZWF2ZScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLm9uKCdtb3VzZWxlYXZlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoaWRlUG9wb3ZlcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAub2ZmKCdtb3VzZWxlYXZlJylcbiAgICAgICAgICAgICAgICAgICAgLm9uKCdtb3VzZWxlYXZlJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBob3ZlcmVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBwb3BvdmVyRWxtMiA9IHRoaXM7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5wb3BvdmVyJykuaG92ZXIoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3ZlcmVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaG92ZXJlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghJCgnLnBvcG92ZXI6aG92ZXInKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICFob3ZlcmVkICYmIGhpZGVQb3BvdmVyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgX190aGlzLm1vdXNlbGVhdmVNaWxsaXNlY29uZHMgfHwgMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBlbWl0IFRyZWUgbm9kZXNcbiAgICAgICAgICAgIHRoaXMubG9hZGVkTm9kZXMuZW1pdCh7IG5vZGVzOiBjYWxsYmFjay5ub2RlREIuZGIsICQgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gY3JlYXRlIFRyZWFudCBpbnN0YW5jZSBhbmQgYWRkIGl0cyBjb250YWluZXIgSURcbiAgICAgICAgLy8gdGhpcyBpbnN0YW5jZSBjYW4gYmUgdXNlZnVsIHRvIG9wZXJhdGUgb24gdGhlIFRyZWVcbiAgICAgICAgY29uc3QgdHJlYW50ID0gbmV3IFRyZWFudCh0aGlzLmRhdGEsIGNhbGxiYWNrLCAkKTtcbiAgICAgICAgdHJlYW50LmNvbnRhaW5lcl9pZCA9IHRoaXMuY2hhcnRJZDtcbiAgICAgICAgdGhpcy5sb2FkZWRUcmVhbnQuZW1pdCh0cmVhbnQpO1xuICAgIH1cbn1cbiIsIjxkaXYgW2NsYXNzTmFtZV09XCJjaGFydENsYXNzXCIgW2lkXT1cImNoYXJ0SWRcIj48L2Rpdj5cbiJdfQ==